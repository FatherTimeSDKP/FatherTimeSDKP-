# ===============================
# FatherTimeSDKP / QCC0 Framework
# Reproducible container for data-driven falsification tests
# ===============================

# ---- Base image ----
FROM python:3.11-slim

# ---- Metadata (for traceability) ----
LABEL maintainer="Donald Paul Smith (FatherTimeSDKP)"
LABEL description="Container for SDKP/QCC0 falsification tests with DVC + Google Drive integration"
LABEL version="1.0.0"

# ---- System setup ----
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    gcc \
    g++ \
    make \
    libssl-dev \
    curl \
    && rm -rf /var/lib/apt/lists/*

# ---- Working directory ----
WORKDIR /app

# ---- Copy dependency lists ----
COPY requirements.txt /app/# Core SDKP/QCC0 scientific dependencies
numpy>=1.26
scipy>=1.12
pandas>=2.2
matplotlib>=3.9
scikit-learn>=1.5

# Version control and pipeline management
dvc[gdrive]>=3.50
gitpython>=3.1

# Bayesian and uncertainty quantification
pymc>=5.10
arviz>=0.16
gpytorch>=1.12
torch>=2.3

# Reproducibility and experiment tracking
pandas-profiling
tqdm
pyyaml

# Optional: for plotting, notebooks, and validation
jupyterlab
seaborn

# ---- Install Python dependencies ----
RUN pip install --no-cache-dir --upgrade pip \
 && pip install --no-cache-dir -r /app/

# ---- Copy local source code ----
COPY src/ /app/src/
COPY dvc.yaml /app/
COPY dvc.lock /app/
COPY .dvc /app/.dvc
COPY experiments/ /app/experiments/

# ---- Environment variables ----
ENV PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    DVC_NO_ANALYTICS=1 \
    DVC_CONFIG=/app/.dvc/config \
    DVC_REMOTE=myremote

# ---- Add Google Service Account Key (mounted at runtime) ----
# Example:
# docker run -v /path/to/key.json:/secrets/key.json:ro \
#             -e GDRIVE_SERVICE_KEY=/secrets/key.json sdkp:latest
ENV GDRIVE_SERVICE_KEY=/secrets/key.json

# ---- Entrypoint ----
# Default to bash for flexible use (can be overridden by docker run)
ENTRYPOINT ["/bin/bash"]
